@page "/organizationpanel"
@inject IOrganizations Orgs
@inject IBitTag bittag
@using BitTagUser.CutomerServices
@using BitTagWebAPP.Services;
@using BitTagDAL
@using BitTagModels


@while (preload == true)
{
    <Loading />
}

<form class="max-w-sm mx-auto" style="padding-top: 120px;">
    <EditForm Model="OrgModel" OnSubmit="SaveOrganization">
        @*         <div class="mb-5">
                <label for="organizationName" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Organization Name: *</label>
                <input type="text" @bind-value="OrgModel.orgName" id="organizationName" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Air University" required>
            </div> *@
        <div class="mb-5">
            <label for="orgName" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Organization Name: *</label>
            <select @bind="@selected" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                @foreach (var item in orgs)
                {
                    <option value="@item">@item</option>
                }
            </select>
        </div>
        @*         <div class="mb-5">
                <label for="organizationType" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Organization's Type: *</label>
                <input type="text" @bind-value="OrgModel.orgType" id="organizationType" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Educational" required>
            </div> *@
        <div class="mb-5">
            <label for="orgType" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Organization Type: *</label>
            <select @bind="@selected2" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                @foreach (var item2 in orgsType)
                {
                    <option value="@item2">@item2</option>
                }
            </select>
        </div>
        <div class="mb-5">
            <label for="organizationAddress" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Organization's Address: *</label>
            <input type="text" @bind-value="OrgModel.orgAddress" id="organizationAddress" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="E-9, Islamabad" required>
        </div>
        <div class="mb-5">
            <label for="qtyRequired" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Quantity (of BitTags) required: *</label>
            <input type="text" @bind-value="OrgModel.orgCapacity" id="qtyRequired" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="500" required>
        </div>
        <button type="submit" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">Submit</button>
        <p class="text-red-200">@msg</p>
    </EditForm>



</form>

@while (successful == true)
{
    <div id="toast-default" class="flex items-center w-full max-w-xs p-4 text-gray-500 bg-white rounded-lg shadow dark:text-gray-400 dark:bg-gray-800" role="alert">
        <div class="inline-flex items-center justify-center flex-shrink-0 w-8 h-8 text-blue-500 bg-blue-100 rounded-lg dark:bg-blue-800 dark:text-blue-200">
            <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 18 20">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.147 15.085a7.159 7.159 0 0 1-6.189 3.307A6.713 6.713 0 0 1 3.1 15.444c-2.679-4.513.287-8.737.888-9.548A4.373 4.373 0 0 0 5 1.608c1.287.953 6.445 3.218 5.537 10.5 1.5-1.122 2.706-3.01 2.853-6.14 1.433 1.049 3.993 5.395 1.757 9.117Z" />
            </svg>
            <span class="sr-only">Fire icon</span>
        </div>
        <div class="ms-3 text-sm font-normal">Data saved successfully.</div>
    </div>
}

@if (showorg == true)
{
    <button class="px-8 py-3 font-semibold ml-20 mb-10 rounded bg-red-400 text-gray-900 max-w-sm mx-auto" @onclick="closeOrg">Close &#x274C;</button>
    <div class="relative overflow-x-auto shadow-md sm:rounded-lg">
        <table class="rounded ml-5 mr-5 w-full text-sm text-left rtl:text-right text-gray-500 main-color text-gray-400">
            <thead class="text-xs uppercase main-color text-gray-50">
                <tr>
                    <th scope="col" class="px-6 py-3">
                        ID
                    </th>
                    <th scope="col" class="px-6 py-3">
                        Name
                    </th>
                    <th scope="col" class="px-6 py-3">
                        Category
                    </th>
                    <th scope="col" class="px-6 py-3">
                        Qty
                    </th>
                    <th scope="col" class="px-6 py-3">
                        Action
                    </th>
                    <th scope="col" class="px-3 py-3">
                        More
                    </th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in organizationList)
                {
                    <tr class="soft-color border-b border-gray-700">
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                            @item.orgName
                        </th>
                        <td class="px-6 py-4">
                            @item.orgType
                        </td>
                        <td class="px-6 py-4">
                            @item.orgAddress
                        </td>
                        <td class="px-6 py-4">
                            @item.orgCapacity
                        </td>
                        <td class="px-6 py-4">
                            <button class="text-red-900" @onclick="(()=>DeleteOrganization(item.orgID))">Delete</button>
                        </td>
                        <td class="px-3 py-4">
                            <a href="orgEmployees/@item.orgID.ToString()" class="font-medium text-blue-950 hover:underline">Add Employee</a>
                        </td>
                    </tr>
                }

            </tbody>
        </table>
    </div>

}

else
{
    <button class="px-8 py-3 font-semibold rounded ml-20 mb-20 bg-blue-950 text-gray-100" @onclick="showOrg">Show Organizations</button>

}






@code {
    OrganizationModel OrgModel = new OrganizationModel();
    List<OrganizationModel> organizationList = new List<OrganizationModel>();
    private bool showorg = false;
    Guid guidID = Guid.Parse("3403ED3D-CAA5-41E5-974B-6F8862311978");
    private bool successful = false;
    private bool preload = false;
    private string? selected { get; set; }
    private string? selected2 { get; set; }
    private string msg { get; set; }
    List<string> orgsType = new List<string>
{
    "University",
    "Research Institute",
    "Government Office",
    "Regulatory Body",
    "Chamber of Commerce",
    "Stock Exchange"
};

    List<string> orgs = new List<string>
{
    "Air University Islamabad",
    "Bahria University Islamabad",
    "Quaid-i-Azam University",
    "National University of Sciences and Technology (NUST)",
    "Pakistan Institute of Development Economics (PIDE)",
    "International Islamic University Islamabad (IIUI)",
    "Allama Iqbal Open University",
    "Pakistan Institute of Engineering and Applied Sciences (PIEAS)",
    "COMSATS University Islamabad",
    "Federal Urdu University of Arts, Science and Technology",
    "Institute of Space Technology (IST)",
    "National Defence University, Islamabad",
    "Pakistan Institute of Medical Sciences (PIMS)",
    "Pakistan Institute of Ophthalmology",
    "Pakistan Institute of Rehabilitation Sciences (PIRS)",
    "Federal Board of Revenue (FBR)",
    "National Institute of Health (NIH)",
    "Pakistan Meteorological Department (PMD)",
    "Pakistan Agricultural Research Council (PARC)",
    "National Accountability Bureau (NAB)",
    "National Institute of Banking and Finance (NIBAF)",
    "Pakistan National Accreditation Council (PNAC)",
    "Pakistan Atomic Energy Commission (PAEC)",
    "Federal Investigation Agency (FIA)",
    "National Database and Registration Authority (NADRA)",
    "Pakistan Bureau of Statistics (PBS)",
    "National Vocational and Technical Training Commission (NAVTTC)",
    "Pakistan Environmental Protection Agency (EPA)",
    "Islamabad Police",
    "Federal Directorate of Education (FDE)",
    "National Institute of Science and Technical Education (NISTE)",
    "National Institute of Electronics (NIE)",
    "Pakistan National Council of the Arts (PNCA)",
    "Pakistan Science Foundation (PSF)",
    "National Book Foundation (NBF)",
    "National Institute of Folk and Traditional Heritage (Lok Virsa)",
    "Pakistan Academy of Letters",
    "National Institute of Oceanography (NIO)",
    "Pakistan Agricultural Research Council (PARC)",
    "Pakistan Engineering Council (PEC)",
    "Pakistan Council of Scientific and Industrial Research (PCSIR)",
    "Pakistan Council of Architects and Town Planners (PCATP)",
    "Pakistan Council of Renewable Energy Technologies (PCRET)",
    "Pakistan Council of Research in Water Resources (PCRWR)",
    "Pakistan Industrial Technical Assistance Centre (PITAC)",
    "National Electric Power Regulatory Authority (NEPRA)",
    "Islamabad Chamber of Commerce and Industry (ICCI)",
    "Islamabad Stock Exchange (ISE)"
};

    private async void saveOrg()
    {
        successful = true;
        preload = true;
        Task.Delay(4000);
        successful = false;
        preload = false;
    }
    private void showOrg()
    {
        showorg = true;
    }

    private void closeOrg()
    {
        showorg = false;
    }

    private async void SaveOrganization()
    {

        Guid id = Guid.NewGuid();
        OrgModel.orgID = id;
        OrgModel.orgName = selected;
        OrgModel.orgType = selected2;
        await Orgs.SaveOrganizations(OrgModel);
        saveOrg();
        await LoadData();
        msg = "Organization Added";

    }

    protected override async Task OnInitializedAsync()
    {
        await LoadData();
    }
    private async void DeleteOrganization(Guid id)
    {
        await Orgs.DeleteOrganizations(id);
        await LoadData();
    }

    private async Task LoadData()
    {
        organizationList = await Orgs.GetOrganizationsById(guidID);
        //organizationList = await Orgs.GetOrganizations();
    }
}
